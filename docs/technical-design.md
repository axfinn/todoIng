# 技术设计

## 概述

todoIng 是一个基于现代 Web 技术栈构建的任务管理系统，它采用前后端分离架构，提供完整的任务生命周期管理和变更历史追踪功能。

## 技术架构

### 前端架构
- **框架**: React 18 + TypeScript
- **状态管理**: Redux Toolkit
- **路由管理**: React Router v6
- **UI框架**: Bootstrap 5
- **构建工具**: Vite
- **HTTP客户端**: Axios
- **国际化**: i18next

### 后端架构
- **运行环境**: Node.js
- **框架**: Express.js
- **数据库**: MongoDB
- **ODM**: Mongoose
- **认证**: JWT + Bcrypt.js
- **邮件发送**: Nodemailer
- **容器化**: Docker

### 数据库设计
- **用户集合**: 存储用户基本信息和认证数据
- **任务集合**: 存储任务数据和变更历史
- **验证码存储**: 内存存储（生产环境建议使用 Redis）

## 核心功能设计

### 用户认证系统

#### 传统认证流程
1. 用户通过邮箱和密码进行注册/登录
2. 密码通过 Bcrypt.js 加密存储
3. 使用 JWT 进行会话管理
4. 可选的图片验证码增强安全性

#### 邮箱验证码认证流程
1. **注册流程**:
   - 用户输入邮箱地址并请求验证码
   - 系统生成验证码并通过邮件发送给用户
   - 用户在注册表单中输入收到的验证码
   - 后端验证验证码有效性并完成注册

2. **登录流程**:
   - 用户选择邮箱验证码登录方式
   - 用户输入邮箱地址并请求验证码
   - 系统生成验证码并通过邮件发送给用户
   - 用户在登录表单中输入收到的验证码
   - 后端验证验证码有效性并完成登录

#### 验证码管理
1. **图片验证码**:
   - 使用 SVG 生成图形验证码
   - 验证码存储在内存中，有过期时间限制
   - 验证一次后立即失效

2. **邮箱验证码**:
   - 使用 crypto 库生成安全的随机验证码
   - 通过 Nodemailer 发送邮件
   - 验证码存储在内存中，有过期时间限制（默认10分钟）
   - 有尝试次数限制（默认3次）
   - 验证一次后立即失效

### 任务管理系统

#### 任务数据结构
- 标题、描述、状态、优先级等基本信息
- 计划日期和截止日期
- 分配给特定用户
- 创建和更新时间戳

#### 任务历史追踪
- 记录每次任务变更的详细信息
- 包括变更时间、变更内容和变更类型
- 提供完整的任务生命周期视图

#### 任务筛选和排序
- 按状态、优先级、日期等条件筛选
- 支持分页和搜索功能
- 多种排序选项

### 安全设计

#### 认证安全
- 密码加密存储
- JWT Token 认证
- 可选的双因素验证（图片验证码）
- 邮箱真实性验证

#### 数据安全
- 输入验证和清理
- 防止常见的 Web 攻击（XSS、CSRF等）
- 数据库查询参数化

#### 通信安全
- HTTPS 支持
- CORS 配置
- 安全的 HTTP 头部设置

### 国际化支持

#### 多语言实现
- 支持中文和英文
- 使用 i18next 管理语言资源
- 动态切换语言

#### 本地化内容
- UI 文本翻译
- 日期和时间格式本地化
- 数字格式本地化

## 部署架构

### Docker 容器化部署
- 前端容器（Nginx）
- 后端容器（Node.js）
- 数据库容器（MongoDB）
- Docker Compose 编排

### 环境配置
- 开发环境
- 测试环境
- 生产环境

## 性能优化

### 前端优化
- 代码分割和懒加载
- 组件缓存
- 图片优化

### 后端优化
- 数据库索引优化
- API 响应缓存
- 连接池管理

### 网络优化
- Gzip 压缩
- CDN 支持
- 资源合并

## 扩展性设计

### 模块化架构
- 功能模块解耦
- 可插拔的组件设计
- 清晰的接口定义

### 可配置性
- 环境变量配置
- 功能开关
- 灵活的参数调整

## 错误处理

### 前端错误处理
- 全局错误捕获
- 用户友好的错误提示
- 错误日志记录

### 后端错误处理
- 统一的错误响应格式
- 详细的错误日志
- 异常恢复机制

## 监控和日志

### 日志管理
- 结构化日志记录
- 日志级别控制
- 日志轮转

### 性能监控
- API 响应时间监控
- 数据库查询性能
- 系统资源使用情况

## 测试策略

### 单元测试
- 关键业务逻辑测试
- 工具函数测试
- 数据验证测试

### 集成测试
- API 接口测试
- 数据库操作测试
- 认证流程测试

### 端到端测试
- 用户流程测试
- UI 交互测试
- 跨浏览器兼容性测试
